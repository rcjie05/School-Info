<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Plan Navigator - Multi-User Enhanced</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/floor-styles.css">
</head>
<body>

    <div class="container active" id="mainApp">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ—ºï¸ Floor Plan Navigator</h1>
                <p id="userModeText">Student Mode â€“ View Only</p>
            </div>

            <div class="user-info">
                <div class="user-info-left" style="display:flex; align-items:center; gap:12px; color:white;">
                    <label for="userRole">Access level:</label>
                    <select id="userRole" onchange="changeUserRole(this.value)">
                        <option value="student" selected>Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="registrar">Registrar</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>

                <div class="user-name" id="userName">ğŸ‘¤ Student</div>
            </div>
        </div>

        <div class="content" id="mainContent">
            <!-- Left Controls (admin only) -->
            <div class="controls">
                <div class="instruction admin-only">
                    ğŸ’¡ <strong><span id="instructionText">Tip</span>:</strong> <span id="instructionContent"></span>
                </div>

                <div class="success-message" id="successMessage"></div>

                <div class="mode-indicator" id="modeIndicator">
                    âœï¸ <strong>Route Drawing Active!</strong> Click on the map to add waypoints to your custom route.
                </div>

                <div class="control-section admin-only">
                    <h3>ğŸ“ Route Setup</h3>
                    <select class="room-select" id="startRoom">
                        <option value="">Select Starting Point</option>
                    </select>
                    <select class="room-select" id="endRoom">
                        <option value="">Select Destination</option>
                    </select>
                </div>

                <div class="control-section admin-only">
                    <h3>ğŸ¨ Create Route</h3>
                    <button class="btn" id="drawRouteBtn" onclick="startDrawingRoute()">
                        âœï¸ Draw Custom Route
                    </button>
                    <button class="btn btn-secondary" onclick="findDirectRoute()">
                        â¡ï¸ Show Direct Route
                    </button>
                    <button class="btn btn-success" onclick="completeRoute()">
                        âœ… Complete Route
                    </button>
                </div>

                <div class="control-section admin-only">
                    <h3>ğŸ’¾ Save Route</h3>
                    <input type="text" class="input-field" id="routeName" placeholder="Enter route name...">
                    <textarea class="input-field" id="routeDescription" placeholder="Optional description..." rows="2"></textarea>
                    
                    <div class="route-visibility">
                        <input type="checkbox" id="visibleToStudents" checked>
                        <label for="visibleToStudents">ğŸ‘ï¸ Visible to students</label>
                    </div>
                    
                    <button class="btn btn-warning" onclick="saveRoute()">
                        ğŸ’¾ Save Current Route
                    </button>
                </div>

                <div class="control-section admin-only">
                    <h3>ğŸ“‹ Route Waypoints</h3>
                    <div id="waypointList" class="waypoint-list">
                        <p style="text-align: center; color: var(--gray-500);">No waypoints yet</p>
                    </div>
                </div>

                <div class="control-section admin-only">
                    <h3>ğŸ”„ Controls</h3>
                    <button class="btn btn-clear admin-only" onclick="undoLastWaypoint()">â†©ï¸ Undo Last</button>
                    <button class="btn btn-clear" onclick="clearRoute()">ğŸ—‘ï¸ Clear Route</button>
                    <button class="btn btn-clear admin-only" onclick="resetAll()">ğŸ”„ Reset All</button>
                </div>

                <div id="routeInfo" class="route-info" style="display: none;">
                    <strong>ğŸ“Š Route Information</strong>
                    <div id="routeDetails"></div>
                </div>
            </div>

            <!-- Center Canvas -->
            <div class="canvas-container">
                <canvas id="floorPlan" width="900" height="700"></canvas>
                
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                    <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">âŠ™</button>
                    <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">âˆ’</button>
                </div>
                
                <div class="legend">
                    <h4>ğŸ—ºï¸ Legend</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #F4D03F;"></div>
                        <span>Administrative</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #85C1E2;"></div>
                        <span>Classrooms</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #7DCEA0;"></div>
                        <span>Services</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #F1948A;"></div>
                        <span>Common Areas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF6B6B;"></div>
                        <span>Route Path</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4ECDC4;"></div>
                        <span>Waypoints</span>
                    </div>
                </div>
            </div>

            <!-- Right Saved Routes (Admin) -->
            <div class="saved-routes admin-only" id="adminRoutesPanel">
                <div class="control-section">
                    <h3>ğŸ“š Saved Routes</h3>
                    
                    <div class="stats-grid" id="adminStats" style="display: none;">
                        <div class="stat-card">
                            <div class="stat-value" id="totalRoutesCount">0</div>
                            <div class="stat-label">Total Routes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="publicRoutesCount">0</div>
                            <div class="stat-label">Public Routes</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="exportRoutes()" style="margin-top: 12px;">
                        ğŸ“¤ Export All
                    </button>
                    <button class="btn btn-success" onclick="document.getElementById('importFile').click()">
                        ğŸ“¥ Import Routes
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none" onchange="importRoutes(event)">
                </div>

                <div id="savedRoutesList">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <p><strong>No saved routes yet</strong></p>
                        <p style="font-size: 0.9em; margin-top: 5px;">Create and save your first route!</p>
                    </div>
                </div>
            </div>

            <!-- Right Public Routes (non-admin) -->
            <div class="saved-routes" id="studentRouteSelector" style="display: none;">
                <div class="instruction" style="margin-bottom: 20px;">
                    ğŸ’¡ <strong>Tip:</strong> Select a route from the list to view navigation on the map!
                </div>
                
                <div class="control-section">
                    <h3>ğŸ“š Available Routes</h3>
                    <input 
                        type="text" 
                        class="input-field" 
                        id="studentRouteSearch" 
                        placeholder="ğŸ” Search routes by name or room..."
                        oninput="filterStudentRoutes()"
                        style="margin-bottom: 15px;"
                    >
                    <p style="color: var(--gray-600); font-size: 0.95em; margin-bottom: 15px;">
                        Click on any route below to display it on the map
                    </p>
                </div>

                <div id="studentRoutesList">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <p><strong>No routes available</strong></p>
                        <p style="font-size: 0.9em; margin-top: 5px;">Check back later for available routes</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/floor-script.js"></script>
</body>
</html>